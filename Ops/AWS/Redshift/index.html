<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Redshift - Patrick's Wiki</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-93920193-1', 'patsancu.github.io/wiki');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../..">Patrick's Wiki</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../OS/Raspberry-Pi/">Raspberry Pi</a>
</li>
                            
<li >
    <a href="../../../OS/Tips/">Tips</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Linux Unix</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../OS/Linux-Unix/Admin/">Admin</a>
</li>
            
<li >
    <a href="../../../OS/Linux-Unix/General/">General</a>
</li>
            
<li >
    <a href="../../../OS/Linux-Unix/Gnome/">Gnome</a>
</li>
            
<li >
    <a href="../../../OS/Linux-Unix/Monitor-Linux-Performance/">Monitor Linux Performance</a>
</li>
            
<li >
    <a href="../../../OS/Linux-Unix/Ubuntu/">Ubuntu</a>
</li>
            
<li >
    <a href="../../../OS/Linux-Unix/problems/">Problems</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">MacOS</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../OS/MacOS/MacOS-Apps/">MacOS Apps</a>
</li>
            
<li >
    <a href="../../../OS/MacOS/macOS-config/">macOS config</a>
</li>
            
<li >
    <a href="../../../OS/MacOS/macOS/">macOS</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Encryption and hashing</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../OS/encryption-and-hashing/GPG-PGP/">GPG PGP</a>
</li>
            
<li >
    <a href="../../../OS/encryption-and-hashing/sha/">Sha</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Ops <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Encrypt-a-partition-with-DM-Crypt-LUKS/">Encrypt a partition with DM Crypt LUKS</a>
</li>
                            
<li >
    <a href="../../Mount-a-remote-file-system-through-ssh-Using-sshfs/">Mount a remote file system through ssh Using sshfs</a>
</li>
                            
<li >
    <a href="../../Network-stuff/">Network stuff</a>
</li>
                            
<li >
    <a href="../../New-environment-from-scratch/">New environment from scratch</a>
</li>
                            
<li >
    <a href="../../SSH/">SSH</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">AWS</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../Cli-Config/">Cli Config</a>
</li>
            
<li >
    <a href="../EC2/">EC2</a>
</li>
            
<li >
    <a href="../Kinesis/">Kinesis</a>
</li>
            
<li class="active">
    <a href="./">Redshift</a>
</li>
            
<li >
    <a href="../S3/">S3</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Docker</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Docker/Docker-Machine/">Docker Machine</a>
</li>
            
<li >
    <a href="../../Docker/Docker/">Docker</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Kubernetes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Kubernetes/Kubernetes/">Kubernetes</a>
</li>
            
<li >
    <a href="../../Kubernetes/Minikube/">Minikube</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Shell</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Shell/Script-building/">Script building</a>
</li>
            
<li >
    <a href="../../Shell/Scripts/">Scripts</a>
</li>
            
<li >
    <a href="../../Shell/Shell/">Shell</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../Software/Alluxio/">Alluxio</a>
</li>
                            
<li >
    <a href="../../../Software/Apache-Drill/">Apache Drill</a>
</li>
                            
<li >
    <a href="../../../Software/Atom/">Atom</a>
</li>
                            
<li >
    <a href="../../../Software/Guake-Terminal-–-Dual-Monitor-Edits/">Guake Terminal – Dual Monitor Edits</a>
</li>
                            
<li >
    <a href="../../../Software/Latex/">Latex</a>
</li>
                            
<li >
    <a href="../../../Software/Multimedia/">Multimedia</a>
</li>
                            
<li >
    <a href="../../../Software/Skype/">Skype</a>
</li>
                            
<li >
    <a href="../../../Software/Tableau/">Tableau</a>
</li>
                            
<li >
    <a href="../../../Software/Useful-software/">Useful software</a>
</li>
                            
<li >
    <a href="../../../Software/Vim/">Vim</a>
</li>
                            
<li >
    <a href="../../../Software/VirtualBox/">VirtualBox</a>
</li>
                            
<li >
    <a href="../../../Software/ffmpeg/">Ffmpeg</a>
</li>
                            
<li >
    <a href="../../../Software/mutt/">Mutt</a>
</li>
                            
<li >
    <a href="../../../Software/packages to install/">Packages to install</a>
</li>
                            
<li >
    <a href="../../../Software/sublime/">Sublime</a>
</li>
                            
<li >
    <a href="../../../Software/tmux/">Tmux</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Web <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../Web/Web-browsing-tips/">Web browsing tips</a>
</li>
                            
<li >
    <a href="../../../Web/Web-dev-resources/">Web dev resources</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dev <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">DB</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../dev/DB/Oracle/">Oracle</a>
</li>
            
<li >
    <a href="../../../dev/DB/Postgres/">Postgres</a>
</li>
            
<li >
    <a href="../../../dev/DB/sqlite/">Sqlite</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Java</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../dev/Java/Gradle/">Gradle</a>
</li>
            
<li >
    <a href="../../../dev/Java/Java-snippets/">Java snippets</a>
</li>
            
<li >
    <a href="../../../dev/Java/Java/">Java</a>
</li>
            
<li >
    <a href="../../../dev/Java/Maven/">Maven</a>
</li>
            
<li >
    <a href="../../../dev/Java/Spring/">Spring</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Misc</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../dev/Misc/Geekeries/">Geekeries</a>
</li>
            
<li >
    <a href="../../../dev/Misc/Markdown/">Markdown</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">VCS</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../dev/VCS/Mercurial/">Mercurial</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Git</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../dev/VCS/Git/Git-problems/">Git problems</a>
</li>
            
<li >
    <a href="../../../dev/VCS/Git/Github/">Github</a>
</li>
            
<li >
    <a href="../../../dev/VCS/Git/Main/">Main</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Python <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../python/Utils/">Utils</a>
</li>
                            
<li >
    <a href="../../../python/">Home</a>
</li>
                            
<li >
    <a href="../../../python/ipython/">Ipython</a>
</li>
                            
<li >
    <a href="../../../python/resources/">Resources</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Django</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../python/Django/Django-errors/">Django errors</a>
</li>
            
<li >
    <a href="../../../python/Django/Django/">Django</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Libraries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../python/libraries/DB/">DB</a>
</li>
            
<li >
    <a href="../../../python/libraries/Faker/">Faker</a>
</li>
            
<li >
    <a href="../../../python/libraries/Misc/">Misc</a>
</li>
            
<li >
    <a href="../../../python/libraries/Web/">Web</a>
</li>
            
<li >
    <a href="../../../python/libraries/beautiful_soup/">Beautiful soup</a>
</li>
            
<li >
    <a href="../../../python/libraries/matplotlib/">Matplotlib</a>
</li>
            
<li >
    <a href="../../../python/libraries/parquet/">Parquet</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Snippets</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../python/snippets/Python-AWS/">Python AWS</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-basics/">Python basics</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-date-time/">Python date time</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-email/">Python email</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-file-management/">Python file management</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-input-output/">Python input output</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-misc/">Python misc</a>
</li>
            
<li >
    <a href="../../../python/snippets/Python-parse-cli-options/">Python parse cli options</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../Kinesis/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../S3/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/patsancu/wiki">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#load-data-into-redsfhit-from-s3">Load data into redsfhit from s3</a></li>
            <li><a href="#escape-strings-with-escape">Escape strings with Escape</a></li>
        <li class="main "><a href="#load-into-redshift-with-custom-field-ordering">Load into redshift with custom field ordering</a></li>
        <li class="main "><a href="#check-errors">Check errors</a></li>
        <li class="main "><a href="#check-info-about-permanent-tables">Check info about permanent tables</a></li>
        <li class="main "><a href="#size-info-about-tables">Size info about tables</a></li>
            <li><a href="#first-method">First method</a></li>
            <li><a href="#second-method">Second method</a></li>
        <li class="main "><a href="#generate-date-series">Generate date series</a></li>
        <li class="main "><a href="#list-schemas">List schemas</a></li>
        <li class="main "><a href="#create-schema">Create schema</a></li>
        <li class="main "><a href="#check-data-load">Check data load</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<ul>
<li>Check the <a href="../../dev/DB/Postgres">postgresql wiki page</a> out:</li>
<li>Check out <a href="https://awsdocs.s3.amazonaws.com/redshift/latest/redshift-dg.pdf">redshift developer's guide</a></li>
</ul>
<p>[List databases] (https://gist.github.com/patsancu/50ea9416c0c7ba5746d045e9b047955d)</p>
<h3 id="load-data-into-redsfhit-from-s3">Load data into redsfhit from s3</h3>
<p>Data can be loaded recursively.
If there's a folder with this structure</p>
<pre><code>a/
  b/
    p.json.gz
  c/
    q.json.gz
    r.json.gz
</code></pre>

<p>Calling the copy sentence with the folder <strong>a</strong> as source will copy all files under the folder recursively</p>
<pre><code class="sql">copy schema.table_name
from 's3://bucket-name/some_folder/some_file.json.gz'
-- from 's3://bucket-name/a'
with credentials 'aws_access_key_id=some_access_key;ws_secret_access_key=supersupersecretkey'
[gzip]
format as json 'auto'
[region 'us-east-1']
-- If the Amazon S3 buckets that hold the data files do not reside in the same region as your cluster, you must use the REGION parameter to specify the region in which the data is located.
</code></pre>

<h4 id="escape-strings-with-escape">Escape strings with Escape</h4>
<p><strong>Remove</strong> the format as csv thing</p>
<pre><code>copy analyticsmodel.playback
from :sql:source
with credentials :sql:redshift-credentials
delimiter '~'
ignoreheader as 1
[escape]
[truncatecolumns Truncates data in columns to the appropriate number of characters it has been specified]
</code></pre>

<h3 id="load-into-redshift-with-custom-field-ordering">Load into redshift with custom field ordering</h3>
<p>You can specify a comma-separated list of column names to load source data fields into specific target columns.
<a href="http://docs.aws.amazon.com/redshift/latest/dg/copy-parameters-column-mapping.html">Docs</a></p>
<pre><code class="sql">copy schema.table (column_a, column_b, column_c, column_d, column_e, colummn_f)
from 's3://some_file.csv'
with credentials 'aws_access_key_id=some_access_key;ws_secret_access_key=supersupersecretkey'
format as csv
ignoreheader as 1
TRUNCATECOLUMNS
</code></pre>

<h3 id="check-errors">Check errors</h3>
<pre><code class="sql">select * from stl_load_errors
order by starttime desc;
</code></pre>

<h3 id="check-info-about-permanent-tables">Check info about permanent tables</h3>
<p>The STV_TBL_PERM table contains information about the permanent tables in Amazon Redshift. More info <a href="http://docs.aws.amazon.com/redshift/latest/dg/r_STV_TBL_PERM.html">here</a></p>
<pre><code class="sql">select * FROM stv_tbl_perm ;
</code></pre>

<h3 id="size-info-about-tables">Size info about tables</h3>
<h4 id="first-method">First method</h4>
<pre><code class="sql">select &quot;database&quot;,
&quot;schema&quot; || '.' || &quot;table&quot;, &quot;size&quot; as &quot;size in Mb&quot;, &quot;tbl_rows&quot; as &quot;rows&quot;
from svv_table_info
</code></pre>

<h4 id="second-method">Second method</h4>
<p>The query below's info  is <strong>not exhaustive nor complete</strong></p>
<pre><code class="sql">SELECT TRIM(pgdb.datname) AS DATABASE,
      TRIM(pgn.nspname) AS SCHEMA,
      TRIM(a.name) AS TABLE,
      b.mbytes,
      a.rows
FROM (SELECT db_id,
            id,
            name,
            SUM(ROWS) AS ROWS
     FROM stv_tbl_perm a
     GROUP BY db_id,
              id,
              name) AS a
 JOIN pg_class AS pgc ON pgc.oid = a.id
 JOIN pg_namespace AS pgn ON pgn.oid = pgc.relnamespace
 JOIN pg_database AS pgdb ON pgdb.oid = a.db_id
 JOIN (SELECT tbl, COUNT(*) AS mbytes FROM stv_blocklist GROUP BY tbl) b ON a.id = b.tbl
ORDER BY a.db_id,
        a.name;
</code></pre>

<h3 id="generate-date-series">Generate date series</h3>
<ul>
<li>Generate series using <strong>any</strong> table as a dummy table.</li>
</ul>
<pre><code class="sql">create table fechas as
select (
    date('2017-06-30') + row_number() over (order by true)
  )::date as fecha
from ibc.playback limit 40
</code></pre>

<p><strong>Warning</strong>. The date_series function thing doesn't work that well on redshift when doing joins and stuff like that. For more info, check redshift's developer guide.</p>
<pre><code class="sql">WITH date_series_bounds AS (
    SELECT date('2012-12-21') as start, date('2013-08-23') as end
), date_series AS (
    select date(days.start + days.interval)
    from (
        select bounds.start, generate_series(0, bounds.end - bounds.start) AS interval from date_series_bounds bounds
    ) as days
)
select * from date_series
</code></pre>

<p>or</p>
<pre><code class="sql">select current_date - (n*30 || ' minutes')::interval
from generate_series (0, 100*5-1) n
</code></pre>

<p>or</p>
<pre><code class="sql">select substr(to_date('2017-06-22', 'YYYY-MM-DD') + (n || ' days')::interval, 1,10)
from generate_series (0, 6) n
</code></pre>

<h3 id="list-schemas">List schemas</h3>
<pre><code class="sql">select *
from information_schema.schemata
</code></pre>

<h3 id="create-schema">Create schema</h3>
<p><code>CREATE SCHEMA IF NOT EXISTS schema_name</code></p>
<h3 id="check-data-load"><a href="http://docs.aws.amazon.com/redshift/latest/dg/r_STL_FILE_SCAN.html">Check data load</a></h3>
<pre><code class="sql">select * from STL_FILE_SCAN
where name like '%screentime%'
order by curtime desc
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
